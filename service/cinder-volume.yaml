service:
  name: cinder-volume
  containers:
    - name: cinder-volume
      image: cinder-volume
      privileged: true
      probes:
        readiness: "true"
        liveness: "true"
      volumes:
        - name: run
          type: host
          path: /run
        - name: dev
          type: host
          path: /dev
      daemon:
        command: cinder-volume --config-file /etc/cinder/cinder.conf
        files:
          - cinder-conf
{%        if cinder_enable_ceph %}
          - ceph-conf
          - cinder-ceph-key
{%        endif %}
        dependencies:
          - cinder-api
files:
  cinder-conf:
    path: /etc/cinder/cinder.conf
    content: cinder.conf.j2
  ceph-conf:
    path: /etc/ceph/ceph.conf
    content: ceph.conf.j2
  cinder-ceph-key:
    path: /etc/ceph/ceph.client.cinder.keyring
    content: ceph.client.cinder.keyring.j2
