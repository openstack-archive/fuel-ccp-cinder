[DEFAULT]
debug = {{ cinder.debug }}
use_forwarded_for = True
use_stderr = True

volume_name_template = volume-%s

os_region_name = RegionOne

enabled_backends = {{ cinder.enabled_backends | join(",") }}

{% if cinder.tls.enabled %}
osapi_volume_listen = 127.0.0.1
{% else %}
osapi_volume_listen = {{ network_topology["private"]["address"] }}
{% endif %}
osapi_volume_listen_port = {{ cinder.api_port.cont }}

api_paste_config = /etc/cinder/api-paste.ini
nova_catalog_info = compute:nova:internalURL
glance_catalog_info = image:glance:internalURL

auth_strategy = keystone

[database]
connection = mysql+pymysql://{{ cinder.db.username }}:{{ cinder.db.password }}@{{ address("database") }}/{{ cinder.db.name }}{% if db.tls.enabled %}?ssl_ca=/opt/ccp/etc/tls/ca.pem{% endif %}
max_retries = -1

{{ keystone_authtoken.keystone_authtoken(cinder.username, cinder.password) }}

{% if glance.tls.enabled %}
[ssl]
ca_file = /opt/ccp/etc/tls/ca.pem
{% endif %}

[glance]
{% if glance.tls.enabled %}
protocol = https
{% endif %}
glance_api_servers = {{ address('glance-api', glance.api_port, with_scheme=True) }}

glance_num_retries = 3
glance_api_version = 2

[oslo_concurrency]
lock_path = /var/lib/cinder/tmp

{% if cinder.ceph.enable %}
[rbd]
volume_driver = cinder.volume.drivers.rbd.RBDDriver
rbd_user = {{ cinder.ceph.username }}
rbd_secret_uuid = {{ cinder.ceph.rbd_secret_uuid }}
rbd_pool = {{ cinder.ceph.pool_name }}
rbd_ceph_conf = /etc/ceph/ceph.conf
{% endif %}

[privsep_entrypoint]
helper_command=sudo cinder-rootwrap /etc/cinder/rootwrap.conf privsep-helper --config-file /etc/cinder/cinder.conf

{% if searchlight is defined and searchlight.services.cinder %}
[oslo_messaging_notifications]
driver = {{ searchlight.notification_driver }}
{% endif %}

{# messaging macros template #}
{{ oslo_messaging[messaging.backend.rpc]('rpc_config') }}
{{ oslo_messaging[messaging.backend.notifications]('notifications_config') }}
